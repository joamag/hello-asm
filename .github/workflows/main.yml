name: Main Workflow
on:
  push:
  schedule:
    - cron: "0 0 * * 0"
jobs:
  build-linux:
    name: Build Linux
    strategy:
      matrix:
        gcc-version: [7, 8, 9, 10, 11, 12]
    runs-on: ubuntu-latest
    container: gcc:${{ matrix.gcc-version }}
    steps:
      - name: Checkout code from repository
        uses: actions/checkout@v3
      - name: Build & Install Dependencies
        run: |
          apt-get update && apt-get install -y -q nasm
      - name: Build Hello ASM
        run: |
          make
      - name: Test Hello ASM
        run: |
          ./hello
  build-windows:
    name: Build Windows
    runs-on: windows-latest
    steps:
      - name: Checkout code from repository
        uses: actions/checkout@v3
      - name: Setup msbuild
        uses: microsoft/setup-msbuild@v1.1
      - name: Build & Install Dependencies
        run: |
          iex "& {$(irm get.scoop.sh)} -RunAsAdmin"
          scoop install make nasm
      - name: Build Hello ASM
        run: |
          $env:PATH += ";$env:USERPROFILE\scoop\apps\nasm\current"
          make -f Makefile.windows
      - name: Test Hello ASM
        run: |
          ./hello
  build-macos:
    name: Build macOS
    runs-on: macos-latest
    steps:
      - name: Checkout code from repository
        uses: actions/checkout@v3
      - name: Build & Install Dependencies
        run: |
          brew install make nasm
      - name: Build Hello ASM
        run: |
          make -f Makefile.mac
      - name: Test Hello ASM
        run: |
          ./hello
